\chapter{Selected Formation Control Strategies}
\label{ch:selformctrl}
\head{This chapter investigates the previously mentioned formation control \todo{ref to seciton here} aspects with focus in three different types of formation control. These three types are analysed with focus on the specific task applied at the Port of Aalborg, afterwards simulated to be able to conclude which of these are the most beneficial to implement at the AAUSHIP fleet.}


\section{Relevant Characteristics}
To have a tool to determine what strategy is the best suited for the
problem described in \vref{sc:mission}, some parameters that describes
different characteristics of a strategy is needed. Listed here is a
description of each key parameter, also mentioning what is desired for
the mission at hand.

\begin{description}
\item[Communication] The communication requirements should be a measure of how much bandwidth is used. If the communication bandwidth usage is low it should be rated as a good thing, since the low bandwidth implies that the communication can be performed more easy and the scalability will become less complicated. It is not of importance if the communication breaks a link of the agents, this will be discussed in the individual formation control categories.

\item[Control architecture] The control architecture is a weighting of the complexity of the control structure. A high weighting will mean that the complexity is low and thus less complicated to implement. It will also be combined with a relation to the type of controller, where a more simple controller can be better if the overall objective can be accomplished. If the control can be done with a less complicated controller, i.e. a \ac{LOS} controller instead of some a more complex controller like \ac{MPC}, this can be preferred.

\item[Obstacle avoidance] The obstacle avoidance does not have a specific rating in the use case of the AAUSHIP due to the assumption of a open water manoeuvring. This means that the weighting of this should be taken as neutral and the implementation will be further work. Yet it is described in the specific control strategies because the implementation of this can be useful in the further work of the AAUSHIP projects. The obstacles can be known pre mission or they can be detected during mission and avoided and the task of the avoidance will take different shapes dependent of the specific task.

\item[Transients] The transients will be a weighting of how well the formation can make a turn and meanwhile keep the formation relative to the path. If the formation are unable to track the path during a turn it will be weighted low and will be the primary weighting. If the formation are able to track the path, but the formation will deviate a little, this will also be a down rating but not as much as if it is unable to track the path. Some formation problems during transients can be solved by the generation of the path but this will result as a limitation to the path generation.

\item[Scalability] The weighting of the scaling is done on two criteria. It is a combination of the structure of the complete formation and a estimate of the bandwidth usage from the higher need of communication. This weighting will be a summed weighting, thus both bandwidth and formation complexity is weighted equally. A rather simple expansion of the formation structure will be preferable, and a relative low bandwidth usage is good. If only communication from a single leader to one respective follower is required, this will be a good thing because if will half the bandwidth usage.
\end{description}

There are also some parameters that is hard to tell by the principle
of the method, which is listed below. These can be used to compare the
strategies after implementation.
\begin{description}
\item[Preparation time] This is related to the mission setup time. How
	much manual labour is needed to prepare the agents for a mission?
	This could for instance be trajectory generation and how the
	specific pattern needs to be generated. If the formation control strategy is chosen such that the agents needs to be close to the specific formation this will also take preparation time to place them relative to the desired formation.
\item[Time] The mission time for covering the area in a boustrophedon
	pattern. This will be from the start of the mission to a complete mission.
\item[Energy efficiency] This is a theoretical measure of the
	formation efficiency. The energy efficiency of any autonomous systems is relevant because it limits how long the autonomous system can operate autonomously, given that it cannot easily recharge or is fatal for the mission. This means that optimising the energy efficiency is desirable.
\item[Wear and tear] Is the controller aggressive? Aggressive
	controllers is known to make more wear and tear on the actuators. So
	if the strategy can be chosen to minimize the wear and tear this
	could be of benefit to the hardware.
\end{description}



%% Oversigt af control stats

\section{Methods}

\subsection{Direct LOS guidance}
The \ac{LOS} guidance makes the basis for a formation where one leader has a single follower connected and this follower has another single follower. \todo{Her skal nok stå en overordnet beskrivelse..}
\subsubsection{Duckling formation}
\label{sc:duckling}
This strategy takes the rise in a duckling or snake formation. In principle is this a leader that has a follower that has a follower and so on. Thereby will the formation take shape as a snake, when the leader takes off and the followers keep the line of sight to their respective leaders. The communication needed in the case of followers only follow one leader, and the communication only works in one direction, then the bandwidth usage is minimal. This implies that the communication it low and simple which is preferable. Similar to the communication will the control architecture become of the simple type where each agent only need to have a \ac{LOS} controller, such that they track their respective leaders. As such is obstacle avoidance not a native implementation of the formation, but can be implemented for the main leader of the formation. By doing this arises a problem of transients where the followers will 'cut corners'. They will directly pursuit their respective leaders, such that the formation will take sharper corners than the main leader. Although the formation does not perform well it has the advantage that the scalability is simple. When linking the formation in the duckling formation a new follower can be attached at the last agent and a new follower to this agent and so on. This implies that, in theory, an infinite tail of followers can be attached.

\subsubsection{Echelon formation}
The echelon formation is a branch from the duckling formation. In this formation the followers to the leader is not in a tail of the leader, but is offset into a echelon formation. The principle being the simple \ac{LOS} controller and the communication as followers to their respective leaders still apply in this branch. This implies that the problem statements from section \ref{sc:duckling} also applies to the echelon formation, and the main difference is the shape of the formation.
\subsubsection{Single \ac{FRP} with path}
\subsubsection{Multiple \ac{FRP} with path}

\subsection{Precomputed individual paths}

\subsubsection{Full communication}
\subsubsection{Limited communication}
\subsubsection{No communication}

\subsection{Potential field}
\subsubsection{Full communication}
\subsubsection{Limited communication}
\subsubsection{No communication}

\begin{itemize}
\item \textbf{Formation via precomputed time parametrised individual paths}
	\begin{itemize}
	\item \textbf{Adaptive formation. Is the time goal reached at each time step for all agents?}\\
	The implementation of this strategy needs to know for each time step for each agent when the goal is. By doing this it is possible to make the agents be in formation at all times because they have individual positions at their respective paths to specific times. If one of the agents does not reach its position in time, the rest of the agents should stop, or slow down, such that the missing agent has the possibility to catch up. This will change the 'time goals' for the rest of the agents, but the agents will keep the formation.
	\item \textbf{No information shared between agents}\\
	If no information is shared between the agents it is assumed that they do not experience any faults. If one of the agents has a fault, that it changes course or slows down, it will make the formation to fail. The individual agents will still follow their respective paths, and therefore reach their end goals, but not at the same time.
	\end{itemize}
\item \textbf{One \ac{FRP} with agents relative to this}\\
This method only makes use of one path for the whole formation. The agents in the setup will be defined with relative positions to a \ac{FRP} at each time step, such that the formation stays rigid and the arms from the \ac{FRP} to the agents are constants. This setup will work as a virtual leader in a rigid formation where only the point on the path (the \ac{FRP}) has information to the agents around it. The individual agents will not be able to communicate, due to the rigid formation.
\item \textbf{Multiple \ac{FRP}s where a formation follows another formation}\\
When more agents are present it could be of benefit to have these in individual subformations. This can be done by defining multiple \ac{FRP}s such that the formations are made relative to these points. Then it is the \ac{FRP}s that needs to be in formation and utilize their informations as formations follow the formation in front. This could be beneficial if a given formation needs to cover a specific area and the rest of the formation needs to continue. This is a tree like leader follower hierachy.
\todo{Det her er en MEGET vag formulering, men jeg er på vej ud af doeren.}
\item \textbf{One minima potential field formation}\\
Within the use of potential fields there can be applied on various ways. One way is to determine the formation based on one minima potential field and maxima at the agents. By different designs of these potential fields one can determine how the specific formation should be. One example could be with three agents where their potential maxima are equal both in magnitude and radius. If these three agents are placed near a single potential minima, they would go in direction of the steepest descent, which would be to the centre of the minima. Meanwhile would the agent's local maxima repulse each other which would result in a equally distributed formation around the potential minima, making a triangle formation around the minima.
This design can vary dependent on how the minima are chosen and also how the magnitude of the agent's potential fields are chosen. If multiple agents are added to the setup, and under the same assumptions as before, they would still distribute evenly around the potential minima, but do the more agents they would make a circle formation. \todo{This method cannot contorl the heading of the formation}
\item \textbf{Multiple minima potential field formation}\\
If an more uneven distribution is needed it could be of benefit to implement more local minima. These are not the minima that the formation should follow, but a higher level potential field, only to define the formation. This could be made of several local minima i.e. one for each agent if the triangle formation is performed. If a more complex formation is needed it would be impossible to make from potential fields if only one local minima could be used, as described in the item above. If a line formation is preferable it would need more local minima to make the distribution even.
\item \textbf{Non strict potential field with rain gutter principle}\\
The underlying potential field can be used when designing the path for the formation. This is done from the same principle of potential fields, but instead of the traditional fields that attract and repel evenly around a point, it can be designed as a rain gutter, which runs from the high magnitude to the lowest magnitude. This will make the formation run in the direction of the steepest descent, and therefore the path can be designed using this. If the formation is allowed to diverge from the path, and the requirement is not so strict, one can design the rain gutter more flat, like a 'u' instead of a 'v', where the 'v' would make the formation stay more precise on the determined path.
\item \textbf{Null Space Behaviour}

\end{itemize}

%% Approaches
\input{mainmatter/potentialfield}

\input{mainmatter/leaderfollower}

\section{Strategy 3: Multi Path following}
Individual paths for the vessels where they follow their respective trajectories with respect to the time. This needs to make a formation for the vessels. They might only need to know from each other how far they are on their respective trajectories, Christoffer Thorvaldsen.

\input{mainmatter/nsbapproach}


\begin{sidewaystable}
\begin{tabular}{l|lll}
\toprule
\textbf{Approach} & \textbf{Communication} & \textbf{Control architecture} & \textbf{Obstacle avoidance} \\
\hline
\textbf{Leader follower:}&&&\\
Duckling with LOS& Simple - Good & Simple LOS - Good & None - Poor \\
Skewed duckling with LOS& Simple - Good & Simple LOS - Good & None - Poor \\
\textbf{Precomputed individual paths:}&&&\\
Full communication& High bw - Poor & Multi agent info - Poor & None - Poor \\
Limited communication& Middle bw - OK & Local agent info - OK & None - Poor \\
No communication& Low bw - Good & Single agent info - Good & None - Poor \\
Single \ac{FRP} with path& Low communication - Good & Simple - Good & None - Poor \\
Multiple \ac{FRP} with path& Middle communication - OK & More agents - Poor & None - Poor \\
\textbf{Potential field:}&&&\\
Full communication& High bw - Poor & Multi agent info - Poor & Natural - Good \\
Limited communication& Middle bw - OK & Local agent info - OK & Natural - Good \\
No communication& Low bw - Good & Single agent info - Good & Natural - Good\\
\bottomrule
 & \textbf{Transients} & \textbf{Scalability}\\
\hline
\textbf{Leader follower:}&&&\\
Duckling with LOS   & Choosing/Poor & Easy duplicate - Good\\
Skewed duckling with LOS & Choosing/Poor & Easy duplicate - Good\\
\textbf{Precomputed individual paths:}&&&\\
Full communication   & Choosing/Good & OK\\
Limited communication   & Choosing/Good & Good\\
No communication   & Choosing/Good & Good\\
Single \ac{FRP} with path   & Choosing/OK & OK\\
Multiple \ac{FRP} with path   & Choosing/Poor & OK\\
\textbf{Potential field:}&&&\\
Full communication    & Good & OK\\
Limited communication    & Good & Good\\
No communication    & Good & Good\\
\end{tabular}
\caption{Decision matrix for the formation strategies}
\label{tab:decision-matrix}
\end{sidewaystable}

