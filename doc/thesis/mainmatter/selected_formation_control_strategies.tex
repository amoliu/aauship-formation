\chapter{Selected Formation Control Strategies}
\label{ch:selformctrl}
\head{This chapter investigates the previously mentioned formation control \todo{ref to seciton here} aspects with focus in three different types of formation control. These three types are analysed with focus on the specific task applied at the Port of Aalborg, afterwards simulated to be able to conclude which of these are the most beneficial to implement at the AAUSHIP fleet.}


\section{Relevant Characteristics}
To have a tool to determine what strategy is the best suited for the
problem described in \vref{sc:mission}, some parameters that describes
different characteristics of a strategy is needed. Listed here is a
description of each key parameter, also mentioning what is desired for
the mission at hand.

\begin{description}
\item[Communication] The communication requirements should be a measure of how much bandwidth is used. If the communication bandwidth usage is low it should be rated as a good thing, since the low bandwidth implies that the communication can be performed more easy and the scalability will become less complicated. It is not of importance if the communication breaks a link of the agents, this will be discussed in the individual formation control categories.

\item[Control architecture] The control architecture is a weighting of the complexity of the control structure. A high weighting will mean that the complexity is low and thus less complicated to implement. It will also be combined with a relation to the type of controller, where a more simple controller can be better if the overall objective can be accomplished. If the control can be done with a less complicated controller, i.e. a \ac{LOS} controller instead of some a more complex controller like \ac{MPC}, this can be preferred.

\item[Obstacle avoidance] The obstacle avoidance does not have a specific rating in the use case of the AAUSHIP due to the assumption of a open water manoeuvring. This means that the weighting of this should be taken as neutral and the implementation will be further work. Yet it is described in the specific control strategies because the implementation of this can be useful in the further work of the AAUSHIP projects. The obstacles can be known pre mission or they can be detected during mission and avoided and the task of the avoidance will take different shapes dependent of the specific task.

\item[Transients] The transients will be a weighting of how well the formation can make a turn and meanwhile keep the formation relative to the path. If the formation are unable to track the path during a turn it will be weighted low and will be the primary weighting. If the formation are able to track the path, but the formation will deviate a little, this will also be a down rating but not as much as if it is unable to track the path. Some formation problems during transients can be solved by the generation of the path but this will result as a limitation to the path generation.

\item[Scalability] The weighting of the scaling is done on two criteria. It is a combination of the structure of the complete formation and a estimate of the bandwidth usage from the higher need of communication. This weighting will be a summed weighting, thus both bandwidth and formation complexity is weighted equally. A rather simple expansion of the formation structure will be preferable, and a relative low bandwidth usage is good. If only communication from a single leader to one respective follower is required, this will be a good thing because if will half the bandwidth usage.
\end{description}

There are also some parameters that is hard to tell by the principle
of the method, which is listed below. These can be used to compare the
strategies after implementation.
\begin{description}
\item[Preparation time] This is related to the mission setup time. How
	much manual labour is needed to prepare the agents for a mission?
	This could for instance be trajectory generation and how the
	specific pattern needs to be generated. If the formation control strategy is chosen such that the agents needs to be close to the specific formation this will also take preparation time to place them relative to the desired formation.
\item[Time] The mission time for covering the area in a boustrophedon
	pattern. This will be from the start of the mission to a complete mission.
\item[Energy efficiency] This is a theoretical measure of the
	formation efficiency. The energy efficiency of any autonomous systems is relevant because it limits how long the autonomous system can operate autonomously, given that it cannot easily recharge or is fatal for the mission. This means that optimising the energy efficiency is desirable.
\item[Wear and tear] Is the controller aggressive? Aggressive
	controllers is known to make more wear and tear on the actuators. So
	if the strategy can be chosen to minimize the wear and tear this
	could be of benefit to the hardware.
\end{description}


%% Approaches
\input{mainmatter/potentialfield}

\input{mainmatter/leaderfollower}

\section{Strategy 3: Multi Path following}
Individual paths for the vessels where they follow their respective trajectories with respect to the time. This needs to make a formation for the vessels. They might only need to know from each other how far they are on their respective trajectories, Christoffer Thorvaldsen.

\input{mainmatter/nsbapproach}


%% Oversigt af control stats

\section{Methods}

\subsection{Direct LOS guidance}
The \ac{LOS} guidance makes the basis for a formation where one leader has a single follower connected and this follower has another single follower. \todo{Her skal nok stå en overordnet beskrivelse..}
\subsubsection{Duckling formation}
\label{sc:duckling}
This strategy takes the rise in a duckling or snake formation. In principle is this a leader that has a follower that has a follower and so on. Thereby will the formation take shape as a snake, when the leader takes off and the followers keep the line of sight to their respective leaders. The communication needed in the case of followers only follow one leader, and the communication only works in one direction, then the bandwidth usage is minimal. This implies that the communication it low and simple which is preferable. Similar to the communication will the control architecture become of the simple type where each agent only need to have a \ac{LOS} controller, such that they track their respective leaders. As such is obstacle avoidance not a native implementation of the formation, but can be implemented for the main leader of the formation. By doing this arises a problem of transients where the followers will 'cut corners'. They will directly pursuit their respective leaders, such that the formation will take sharper corners than the main leader. Adding to that if one agent fails during mission every agent after this in the chain fails. Although the formation does not perform well it has the advantage that the scalability is simple. When linking the formation in the duckling formation a new follower can be attached at the last agent and a new follower to this agent and so on. This implies that, in theory, an infinite tail of followers can be attached.

\subsubsection{Echelon formation}
The echelon formation is a branch from the duckling formation. In this formation the followers to the leader is not in a tail of the leader, but is offset into a echelon formation. The principle being the simple \ac{LOS} controller and the communication as followers to their respective leaders still apply in this branch, but the reference is given to the followers as a offset with an angle and a degree. This implies that the problem statements from section \ref{sc:duckling} also applies to the echelon formation, and the main difference is the shape of the formation and how the reference is passed on.

\subsubsection{Single \ac{FRP} with path}
This method only makes use of one path for the whole formation. The agents in the setup will be defined with relative positions to a \ac{FRP} at each time step, such that the formation stays rigid and the arms from the \ac{FRP} to the agents are constants. This setup will in principle work as the followers working in a rigid formation where only the point on the path (the \ac{FRP}) determines where the agents need to go. The reference given to the agents will be a position in the \ac{FRF}, and the formation will have the origo (turning point) in the \ac{FRP}. The individual agents will not be able to communicate, due to the rigid formation, but only keep the position relative to the \ac{FRP}. If the formation stays rigid during transients there will be no problem with collision. If one single agent in the \ac{FRF} fails it will just fall out of the formation and the rest will continue the mission.

\subsubsection{Multiple \ac{FRP} with path}
\todo{Denne er ikke rettet til, men den skulle også væk, eller hvordan? Det er jo abre formation følger formation.}
When more agents are present it could be of benefit to have these in individual sub formations. This can be done by defining multiple \ac{FRP}s such that the formations are made relative to these points. Then it is the \ac{FRP}s that needs to be in formation and utilize their informations as formations follow the formation in front. This could be beneficial if a given formation needs to cover a specific area and the rest of the formation needs to continue. This is a tree like leader follower hierarchy.

\subsection{Precomputed individual paths}
\subsubsection{Full communication}
The implementation of this strategy needs to know for each time step for each agent when the goal at the trajectory is. By doing this it is possible to make the agents be in formation at all times because they have individual positions at their respective paths to specific times. If one of the agents does not reach its position in time, the rest of the agents should stop, or slow down, such that the missing agent has the possibility to catch up. This will change the 'time goals' for the rest of the agents, but the agents will keep the formation. The other option is that the slower agent speeds up, if the agents are not already working at full speed. In this formation principle every agent needs formation about where the others are, which might not be preferable when looking at the bandwidth usage and the scalability of this principle. The same problem will arise when looking at the control architecture, which will only expand more and more when adding more agents. If every agent needs to know information for the others, and act dependent on every single other agent, then the decision and the task allocation will become more complex. When looking into the problem of transients and 'cutting corners', the strategies with individual paths does not have any problems with this. If the formation does cut corners and fail in transients, it is mainly a design error of the path, such that the paths intersect each other. If one of the agents fail during mission then rest will keep close to that agent, unless some kind of exception handling has been made, such that the rest can continue the mission.

\subsubsection{Limited communication}
The overall principle of this implementation is the same as when full communication, the one mentioned above. The difference is that the communication will be greatly decreased when looking at the bandwidth usage and how many agents that needs to know of each other. In this formation strategy agent $i$ only knows information about the neighbour agents, $i_{-1}$ and $i_{1}$.By doing this the information about a slower, or even failed, agent needs to propagate through the formation. If the formation is relatively small, it will not make any remarkable change in the formation structure. If the formation is of a larger size, then the formation will not be as rigid as the one with full communication. If the outer most agent for some reason slows down, then the neighbour needs to act according to that, and the the neighbour of the neighbour needs to act according to that and so on. This will make the formation, in this situation, become skewed, but will go into formation again over time. This is a downside when looking at the transients of the formation and how rigid it is. If the given agent completely fails the mission and breaks down, then the same applies as if there were full communication. An exception needs to be programmed such that the formation will leave the failed agent. The advantage of this strategy is that the control architecture and the communication level will become less complicated, and the scalability to in theory infinitely many agents becomes possible.

\subsubsection{No communication}
Again is the main principle the same for this strategy, only that no information is shared between the agents. If no information is shared between the agents it is assumed that they do not experience any faults. If one of the agents has a fault, that it changes course, slows down or fails in the mission, it will make the formation to fail. The individual agents will still follow their respective paths, and therefore reach their end goals, but not at the same time. If the agent has failed the mission the others does not take this into account, but instead continues their individual mission. The communication in this strategy is very low, since the agents does not exchange information at all. The control architecture also becomes less complex while this strategy only controls the individual agents i.e. with a simple \ac{LOS} controller to track their individual paths. If the individual paths have been generated properly there should not be any problems relating the transients, if assumed that every agent follows its path with acceptance. If it does not, and deviate a little, the formation is not rigid. If one agent fails in the mission, it will also lead to formation deviation, but the rest of the agents will keep their respective goals. Though when working as individual agents, this also implies that the scalability becomes less complex because the control is applied at the individual agent that follows its own path.

\subsection{Potential field}
\subsubsection{Full communication}
In the strategy with potential fields the level of communication can also vary. If the communication can be shared by all the agents within the potential field, the communication is said to be full. When this is the case, every agent has the information about every other agents position and potential field. This makes the formation, made by the potential field, able to correct if any agent starts to fall behind. This concept is the same as with the precomputed paths, where the communication also could be full. In this case the bandwidth usage is also larger when having full communication than with lower communication. Therefore is the communication level also more complex then every agent needs to exchange information with each other. When every single agent need to be dependent on all the other agents, the constraint level gets higher and the complexity of the needed control architecture also becomes higher. When every agent knows the potential fields of the others there should not become any collision problems in transients. But the formation in general is not as rigid when working with potential fields, because of the principle of attraction and repelling. If one single agent fails, breaks down, the others should still know of its appearance such that they can use the potential field to manoeuvre away from the agent. This is mainly to avoid collision. When the communication and the control architecture becomes more complex under full communication, the scalability also becomes more complex. It is not impossible to scale, but a scaling in theory to infinity will become very complex.

\subsubsection{Limited communication}
When the communication is said to be limited it means that not all agents can communicate with each other. The communication range of the agents are reduced, such that i.e. agent $i$ only can communicate with agent $i_{-1}$ and $i_{1}$, but the range can also be large, $i_{-r}$ and $i_{r}$, where $r$ is the communication radius. When doing this the same thing will happen as in the case of limited communication with the individual paths. If one agent starts falling behind then the nearby agents starts to reach first, which then leads to that all agents will reach on the slower agent. Dependent on the formation this will make different hurdles. The formation can try to manoeuvre dependent on the slower agent, but they meanwhile have to follow the potential field map, the given trajectory. In the case of limited communication the same things apply to transients as when full communication, but the formation might diverge more from the determined due to the passing of information between the agents. If one agent breaks down the same goes as with full information, because only the closest agents needs the information about the breakdown to avoid collision. The rest can still continue the mission afterwards. The scaling of the formation becomes a little less complicated than if the agents needed to know information from every agent. Though the potential field mapping will still be complex, and the trajectory generation can be hard.

\subsubsection{No communication}
In the case where no communication are to find in the system the agents will act like no potential field exists from the other agents, and try to follow the potential field trajectory. This will make every agent, independent of the others, try to follow the trajectory and thereby be in the same point. This will over time make the agents collide, if not on the way to the mission goal then at the mission goal. This means that in this case they need a individual potential field trajectory. When making individual potential field trajectories will the scenario be as in the case of individual paths, where the agents will be controlled individually but with respect of a potential field trajectory. This may also lead to colliding agents but it is not necessary as it will be if they followed the same trajectory. If they follow the same reference trajectory a failed agent will result in all the others following behind that will collide resulting in a complete mission failure. Though if the agents instead have their own respective reference trajectory one failing will not fail the mission. If the formation are unlucky, they can collide, but not necessarily.

%\item \textbf{One minima potential field formation}\\
%Within the use of potential fields there can be applied on various ways. One way is to determine the formation based on one minima potential field and maxima at the agents. By different designs of these potential fields one can determine how the specific formation should be. One example could be with three agents where their potential maxima are equal both in magnitude and radius. If these three agents are placed near a single potential minima, they would go in direction of the steepest descent, which would be to the centre of the minima. Meanwhile would the agent's local maxima repulse each other which would result in a equally distributed formation around the potential minima, making a triangle formation around the minima.
%This design can vary dependent on how the minima are chosen and also how the magnitude of the agent's potential fields are chosen. If multiple agents are added to the setup, and under the same assumptions as before, they would still distribute evenly around the potential minima, but do the more agents they would make a circle formation. \todo{This method cannot contorl the heading of the formation}
%\item \textbf{Multiple minima potential field formation}\\
%If an more uneven distribution is needed it could be of benefit to implement more local minima. These are not the minima that the formation should follow, but a higher level potential field, only to define the formation. This could be made of several local minima i.e. one for each agent if the triangle formation is performed. If a more complex formation is needed it would be impossible to make from potential fields if only one local minima could be used, as described in the item above. If a line formation is preferable it would need more local minima to make the distribution even.
%\item \textbf{Non strict potential field with rain gutter principle}\\
%The underlying potential field can be used when designing the path for the formation. This is done from the same principle of potential fields, but instead of the traditional fields that attract and repel evenly around a point, it can be designed as a rain gutter, which runs from the high magnitude to the lowest magnitude. This will make the formation run in the direction of the steepest descent, and therefore the path can be designed using this. If the formation is allowed to diverge from the path, and the requirement is not so strict, one can design the rain gutter more flat, like a 'u' instead of a 'v', where the 'v' would make the formation stay more precise on the determined path.


\begin{sidewaystable}
\begin{tabular}{l|lll}
\toprule
\textbf{Approach} & \textbf{Communication} & \textbf{Control architecture} & \textbf{Obstacle avoidance} \\
\hline
\textbf{Leader follower:}&&&\\
Duckling with LOS& Simple - 1 & Simple LOS - 1 & None - 0 \\
Skewed duckling with LOS& Simple - 1 & Simple LOS - 1 & None - 0 \\
\textbf{Precomputed individual paths:}&&&\\
Full communication& High bw - 0 & Multi agent info - 0 & None - 0 \\
Limited communication& Middle bw - 0 & Local agent info - 0 & None - 0 \\
No communication& Low bw - 1 & Single agent info - 1 & None - 0 \\
Single \ac{FRP} with path& Low communication - 1 & Simple - 1 & None - 0 \\
Multiple \ac{FRP} with path& Middle communication - 0 & More agents - 0 & None - 0 \\
\textbf{Potential field:}&&&\\
Full communication& High bw - 0 & Multi agent info - 0 & Natural - 1 \\
Limited communication& Middle bw - 0 & Local agent info - 0 & Natural - 1 \\
No communication& Low bw - 1 & Single agent info - 1 & Natural - 1\\
\bottomrule
 & \textbf{Transients} & \textbf{Scalability} & \textbf{Failure}\\
\hline
\textbf{Leader follower:}&&&\\
Duckling with LOS   & Choosing - 0 & Easy duplicate - 1 & 0 \\
Skewed duckling with LOS & Choosing - 0 & Easy duplicate - 1 & 0 \\
\textbf{Precomputed individual paths:}&&&\\
Full communication   & Choosing - 1 & 0 & 0 \\
Limited communication   & Choosing - 1 & 1 & 0 \\
No communication   & Choosing - 1 & 1 & 0 \\
Single \ac{FRP} with path   & Choosing - 0 & 0 & 1 \\
Multiple \ac{FRP} with path   & Choosing - 0 & 0 & 1 \\
\textbf{Potential field:}&&&\\
Full communication    & 1 & 0 & 1 \\
Limited communication    & 1 & 1 & 1 \\
No communication    & 1 & 1 & 0 \\
\end{tabular}
\caption{Decision matrix for the formation strategies}
\label{tab:decision-matrix}
\end{sidewaystable}

