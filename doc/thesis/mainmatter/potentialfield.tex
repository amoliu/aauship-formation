\section{Strategy 1: Potential field formation}
\label{sc:potential-fields}
% Papers of interrest to this topic
A Potential Field Based Approach to Multi-Robot Manipulation \citep{pfmrm}\\
Formation Control with Configuration Space Constraints, \citep{fccsc}\\
UAV Formation Flight using 3D Potential Field, \citep{UAVff3dpf}\\


\subsection{Potentialfield}
In potential fields it is commonly used that a multi-robot group should move in an environment, either with or without obstacles, some papers are \citep{pfmrm}, \citep{fccsc} and \citep{UAVff3dpf}. In the environment there needs to be specified some relative measurements, or states, such that the robots are capable to manoeuvre relative to something. This reference, that the robots should manoeuvre with, is in this case the potential fields. When looking at robots that should keep distance from each other (in a formation), or should move to a desired position (trajectory tracking), the implementation of potential fields come in handy.

The potential field approach can be utilised or implemented in
different ways when taking about formation control. Potential fields
is often used for cooperative control where the formation between
agents is not important, but rather have the goal of moving groups of
agents from one point to another. \todo{Reference papers here} So to
use the potential field mindset it is important to define how these
fields works together to achieve some form of formation that can be
moved after a predefined path. 

Some ideas is to use a individual potential field seen from each
agent and combine this with the other agents local potential field.
Here the potential field has local minima defining the desired
formation. In addition to this there is also a need to define how this
formation can be moved in a predefined path.

Another idea is to use the same potential field, that is a global and
common time varying potential field to define the formation, but this
will require that the agents are already near their formation, such
that every agent will approach their separate local minimum. This can
be used as a leader follower concept where the leader is defining this
global potential field.

These fields can be defined from attraction- and repulsion potential fields, dependent on if the robots needs to move toward or away from a target, described in \citep{pfmrm}, where potential fields are utilized to a virtual structure. When applying a virtual structure the group of robots follow a virtual leader and not an other robot relative to the formation. The potential functions can now be used as forces between the agents to repel them, such that they do not collide, which can be called inter-vehicle forces. The potential functions are also used as forces around the virtual leader such that the agents gets as close as possible to the virtual leader without ever reaching it, which can be called virtual leader forces. This will make a distributed formation around the virtual leader \citep{1655803}. The repelling forces can be utilized in different ways and with advantage used with obstacle avoidance. A great advantage to the virtual leader is that the potential forces can be used to keep the formation and then only generate the trajectory for the virtual leader and not for every individual agent \citep{1655803}.


%A attractive potential can be written in a quadratic way as:
%\begin{align}
%V_{io}^a = \frac{1}{2}k_{io}r_{io}^2
%\end{align}
%\todo{Der skal lige læses i ref [8, 17] for at finde de helt præcise beskrivelser}
%which depends on the position vectors of the robots and the objective, or end position. Likewise can a repulsive potential be expressed as:
%\begin{align}
%V_{ij}^r = k_{ij}/r_{ij}
%\end{align}
%which is dependent on the euclidean distance between the robots.
%The gradient of the potential fields defines the driving force of the robots and the trajectory should be calculated by simulating based on the dynamics %of the system. \todo{Det er vildt svært at finde ud af det her.}

% This is a summary of how they use Potential Fields in "UAV Formation Flight using 3D Potential Field"
\subsubsection{One approach for Potential Fields}
In the following approach is generated a potential field for each agent depending on obstacles, formation, desired and actual position. It will be a combination of virtual leader and potential field. The principle generates a potential field to keep the formation and that field is moved around as a virtual leader. When the virtual leader is moved around results in a deflection of the desired position and causes the affected agents to get back into position. The positions of the agents in the field is given individually to the specific agents relative to the virtual leader. The approach generates a single resulting vector for each agent which is used to guide the agent. The potential field for each agent is generated from four components:
\begin{align}
\tilde{F}_i^{tot} = F_{vl}+F_{ij}^{tot}+F_{ca}^{tot}+F_{oa}^{tot}
\end{align}
where:
\begin{ffk}
$F_{vl}$ are forces to the virtual leader\\
$F_{ij}^{tot}$ are forces contributed from other agents to the field\\
$F_{ca}^{tot}$ are a field component pointing away from the agent is collision is close\\
$F_{oa}^{tot}$ are forces used for obstacles in the field and introducing the obstacle avoidance
\end{ffk}
\begin{itemize}
\item $F_{vl}$ virtual leader\\
The virtual leader is an anchor of each formation and controls the movement of this. This movement can either be given as a full trajectory of as a set of waypoints. The local virtual leader's part to the potential field is:
\begin{align}
F_{vl} &= K_{vl}(p_{vl}^n-p_i^n-[p_{vl}^n-p_{i0}^n])\\
&= K_{vl}(d_i-d_{i0})
\end{align}
$K_{vl}$ is a tuning parameter. $p_{vl}$ is position of the virtual leader, $p_i$ is position of agent $i$, $p_{i0}$ is desired position of agent $i$ and the $d$ is a shorter notation for the distances in between. The virtual leader component guides the agents directly to their desired positions relative to the virtual leader.

\item $F_{ij}$ inter vehicle influence\\
This is the contribution of other vehicles to the potential field, which is expressed as:
\begin{align}
F_{ij} &= K_{ij}(p_{j}^n-p_i^n-[p_{j0}^n-p_{i0}^n])\\
&= K_{ij}(d_{ij}-d_{ij0})
\end{align}
Similar to the previously the $p$s are positions, $K_{ij}$ is a tuning parameter and $d$ is a shorter notation for the distances in between. This component preserves the formation by affecting the agents to keep their respective desired distances among themselves. Therefore is ratio between $K_{vl}$ and $K_{ij}$ a weighting that causes the agents to follow the virtual leader or to preserve their desired formation. In a swarm of $N$ agents the total component for agent $i$ given by:
\begin{align}
F_{ij}^{tot} = \sum\limits_{j=1}^NF_{ij}(i,j) \text{ for } j\neq i
\end{align}

\item $F_{ca}$ collision avoidance\\
The collision avoidance takes effect when the agents get closer than a pre defined distance of each other. It generates an additional field component for the vehicle $i$ which points away from the entering agent causing the agents to move away from each other. To ensure the avoidance the component converges towards infinity in the centre of the $i$'th agent. The $F_{ca}$ is expressed as:
\[
    F_{ca}^{ij}= 
\begin{cases}
    \frac{K_{ca}r}{||d_{ij}||}-K_{ca},& \text{for } ||d_{ij}||<r\\
    0,              & \text{otherwise}
\end{cases}
\]
where $K_{ca}$ is a tuning parameter. $r$ is the safety radius for collision and $d_{ij}$ is the distance between the individual agents.
The collision avoidance can be expressed in a total term of the collision avoidance:
\begin{align}
F_{ca}^{tot} = \sum\limits_{j=1}^NF_{ca}^{ij} \text{ for } i\neq j
\end{align}

\item $F_{oa}$ obstacle avoidance\\
The same principle as for collision avoidance can be applied to obstacle avoidance. Now each obstacle needs to be handled as an agent, which will make the same result, but the reference is a little different:
\[
    F_{oa}^{ik}= 
\begin{cases}
    \frac{K_{oa}}{||d_{ki}||}-\frac{K_{oa}}{r},& \text{for } ||d_{ki}||<r\\
    0,              & \text{otherwise}
\end{cases}
\]
where $k$ denotes the counter for obstacles instead of other agents. $K_{oa}$ is also a tuning parameter for the obstacle avoidance. $d_{ki}$ is the distance between an agent and the obstacle, which in a total term is summed up as:
\begin{align}
F_{oa}^{tot} = \sum\limits_{k=1}^MF_{oa}^{ik} \text{ for } i\neq k
\end{align}
Here $d_{ki}$ represents one of the $M$ place vectors which has the effect as a detected obstacle.
The distance $r$ can be determined dynamically depending on the velocity of the agent:
\begin{align}
r = r^{min} + K_r||\dot{p^n}||
\end{align}

\item Potential field\\
Now these forces needs to be summed together to get $\tilde{F}_i^{tot}$ which gives the magnitude and direction of the potential field for vehicle $i$ at its current position. As the potential field does not need to expand to infinity it is reasonable to define a maximum amplitude for the vector, while still keeping its direction:
\begin{align}
F_i^{tot} = min\{\,\,\,||\tilde(F)_i^{tot}||\,\,\,,\,\,F_{max}\,\,\,\}\frac{\tilde{F}_i^{tot}}{||\tilde{F}_i^{tot}||}
\end{align}

\end{itemize}
\todo{Dette er en hurtigere gennemgang af denne metode, som ikke giver SÅ meget mening uden et billede. Men der anvendes et potentiale felt pr agent, som skal placeres ud fra et FRP, som igen flyttes rundt i det givne miljø.}



