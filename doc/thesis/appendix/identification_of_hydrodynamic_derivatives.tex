\chapter{Identification of hydrodynamic coefficients}
\label{app:damping}

\section{Purpose}
The purpose with this test is to
identify the hydrodynamic coefficients used in the linear model for
AAUSHIP.

\section{Theory} The theory behind this measurement journal is as
described in section \ref{sec:hydrocoeff}, and is expanded in this
journal to explicitly get the coefficients needed. The purpose is to
identify the hydrodynamic damping coefficients for the 5 \ac{DOF} damping
matrix~\vref{eq:damping-matrix}. This is accomplished by
three sea trails; a surge test, a sway test and a yaw
test, together with roll and pitch tests in a small basin.

%but some of these have been estimated by \citep{13gr931} and are used directly from that work.

%\todo{Are we using the values 13gr931 found, else, state which
%	parameters exactly. If then, it might be better to state them as a
%result. Or if not used here at all, then don't mention them.}

%\todo{There is no explicit equations on how to actually
%evaluate/calculate the data}

The surge, sway and yaw tests are performed with theory of one method of testing, and theory of another method is used when determining pitch and roll. The damping in surge, sway and yaw is estimated by fitting data to a first order differential equation where the pitch and roll dampings are determined from fitting onto a second order differential equation. These two ways of determining the damping coefficients will be denoted \textit{method one} for the first order fitting and \textit{method two} for the second order fitting.

\subsection{Method one}
This method is used to fit a first order differential equation to be able to estimate the damping coefficient. This is done by performing a test of the vessel. The vessel is accelerated to a constant velocity from where the input is taken away. This will make a velocity curve as seen on figure \ref{fig:phase3}.
\begin{figure}[htbp]
	\centering
	\includesvg[width=0.5\textwidth]{phase3}
	\caption{Constant velocity followed by zero input.}
	\label{fig:phase3}
\end{figure}
From this it is possible to fit the dynamic model including damping of the vessel such that the damping coefficient can be determined. When looking at the motion in surge, this should be fitted by the following method. The dynamic equation in surge, as a homogeneous equation, is given by:
\begin{align}
m \ddot x + D \dot x &= 0
\label{eq:dynsurgeeq}
\end{align}
A guess to fit such a first order differential equation could be:
\begin{align}
u = k \cdot e^{-st}
\end{align}
This is the expression of the surge speed, as seen from figure \ref{fig:phase3}. This is plugged into the dynamic equation to be able to fit the dynamic equation to the differential equation.
\begin{align}
m \dot u + Du &= 0\\
m \cdot (-kse^{-st}) + D \cdot k \cdot e^{-st} &= 0\\
-ms+D&=0\\
s&=\frac{D}{m}
\end{align}
This makes the surge velocity to be expressed as:
\begin{align}
u = k \cdot e^{-\frac{D}{m}t}
\end{align}
By setting the time to zero gives the initial velocity:
\begin{align}
u_0 = k
\end{align}
After the damping is determined is the input force the only unknown in the dynamic equation \eqref{eq:dynsurgeeq}. The input force, to reach the constant velocity $u_0$, can be determined by the same principle but should be applied to a curve rising from zero velocity to the constant velocity. This would look as seen in figure \ref{fig:phase1}.
\begin{figure}[htbp]
	\centering
	\includesvg[width=0.5\textwidth]{phase1}
	\caption{Zero velocity followed by constant velocity.}
	\label{fig:phase1}
\end{figure}
The differential equation to fit this curve would be given by the inhomogeneous equation:
\begin{align}
u_{\text{inh}} &= u_0 - u_{\text{h}}\\
u &= u_0 - k \cdot e^{-st}
\end{align}
where the $s$ still would be given as:
\begin{align}
s = \frac{D}{m}
\end{align}
From this is the input force, to reach $u_0$, given from:
\begin{align}
m \dot u + Du &= \tau
\end{align}

\subsection{Method Two}
The second method is used when determining coefficients as pitch and roll, $r$ and $p$. In these tests is the vessel put to a maximum angle in pitch or roll and is afterwards released. This will make the vessel converge to steady state, as seen on figure~\vref{fig:harmonic-damping}. This damping must be determined by fitting the damping to a second order differential equation. This can be illustrated by looking at the determination of the damping coefficient $Y_p$.


The damping coefficient $Y_p$ can be found from the dynamic equation of roll by:
\begin{align}
mZ_g\ddot \varphi + Y_p\dot \varphi = 0
\end{align}
$\varphi$ is the position of the angle of the vessel. This is the position that needs to follow the damping as seen on figure~\vref{fig:harmonic-damping}. This can be fit to a second order differential equation. The position of the angle can be expressed as:
\begin{align}
\varphi = ke^{-st} \cdot \cos(\omega t)
\end{align}
A standard second order polynomial is given by:
\begin{align}
ay''+by'+cy = 0
\end{align}
This can be rewritten by the following:
\begin{align}
mZ_g\ddot \varphi + Y_p\dot \varphi = 0\\
-as^2+bs+0=0\\
s^2-\frac{b}{a}s=0
\end{align}
This makes, in the standard solution of the second order equation, $a=1$ amd $b=-\frac{b}{a}$. The standard solution will then become:
\begin{align}
s &= \frac{-b+\sqrt{b^2-4ac}}{2a}\\
s &= \frac{\frac{b}{a}+\sqrt{(-\frac{b}{a})^2}}{2}
\end{align}
where:
\begin{align}
\frac{b}{a} = \frac{Y_p}{mZ_g}
\end{align}
This can then be fit to a position given by the previous:
\begin{align}
\varphi = ke^{-\left(\frac{\frac{b}{a}+\sqrt{(-\frac{b}{a})^2}}{2}\right)t} \cdot \cos(\omega t)
\end{align}

\subsection{Which parameters to determine}
The parameters that needs to be determined is the damping coefficients from the damping matrix. The 5 \ac{DOF} damping matrix is given by:
\begin{align}
D = -
\begin{bmatrix}
X_u & 0 & 0 & 0 & 0\\
0 & Y_v & Y_p & 0 & Y_r\\
0 & K_v & K_p & 0 & K_r\\
0 & 0 & 0 & M_q & 0\\
0 & N_v & N_p & 0 & N_r
\end{bmatrix}
\end{align}
The different coefficients can be found by writing the complete dynamic system:
\begin{align}
M_{RB} \dot \nu + D\nu = \tau
\end{align}
where:
\begin{align}
\nu =
\begin{bmatrix}
u & v & p & q & r
\end{bmatrix}^T
\end{align}
and



\subsubsection{Surge test}
%From the surge test it is possible to estimate the damping coefficient in $x$, being $X_u$. This can be estimated by
%\begin{align}
%m \ddot x - X_u \dot x &= 0\\
%X_u &= \frac{m \ddot x}{\dot x}
%\end{align}
%Measurements of the \ac{GPS} on the vessel and the gyroscope can be used to estimate the position, velocity and acceleration.

\subsubsection{Sway test}
%From the sway test it is possible to estimate the damping coefficient in $y$, being $Y_v$. This can be estimated by
%\begin{align}
%m \ddot y - Y_v \dot y &= 0\\
%Y_v &= \frac{m \ddot y}{\dot y}
%\end{align}
%Measurements of the \ac{GPS} on the vessel and the gyroscope can be used to estimate
%the position, velocity and acceleration.
Hej2

\subsubsection{Yaw test}
%From test of rotation it is possible to estimate the damping coefficient due to rotation, being $N_r$. This can be estimated by
%\begin{align}
%I_z\ddot \psi - N_r \dot \psi &= 0\\\
%N_r &= \frac{I_z \ddot \psi}{\dot \psi}
%\end{align}
%The vessel may not move in $x$ and $y$ directions which can be verified by the \ac{GPS}. The gyroscope measures the velocity and acceleration of the moment.

%In all three tests it is of importance that the vessel only moves in the respective directions such that only a pure damping in the directions is measured. After measurement of the three first coefficients it is possible to determine the last two. These are solved by the following
%\begin{align}
%m \ddot y + mx_g\ddot\psi - Y_v \dot y - Y_r \dot \psi = \tau
%\end{align}

%\begin{align}
%mx_g \ddot y + I_z\ddot \psi - N_v \dot y - N_r \dot \psi = \tau
%\end{align}
Hej3


\section{Tools}
Tools needed are:
\begin{itemize}
	\item AAUSHIP equipped with:
		\begin{enumerate}
			\item Controller for surge only
			\item Controller for sway only
			\item Controller for yawing only
			\item Logging capability for \ac{IMU}, GPS1, GPS2 with UBX data
				and control inputs.
		\end{enumerate}
	\item Computer to set remote parameters and tele operation
	\item RTK base station logging UBX data.
\end{itemize}
To be able to make the tests the AAUSHIP needs to have both forward thrusters and sideways thrusters. These are implemented and can be controlled from a computer.

\section{Method}
The tests performed are as follows:
\todo{Hvordan konverteres maaleresultater til de noedvendige tal fra ligningerne? Dette har vaeret et stoerre spsergsmaal og problem! Vi kan godt se, at der skal vaere en sammenhaeng mellem hastigheden og daempningen, men vi kan ikke faa det skrevet ud i vores ligninger. Vi kan ikke loese ligningen (fatsvag)}

\todo{Skriv hvilke log data der skal opsamles}
\begin{enumerate}
	\item The first test is a \textit{surge} test. This test is done to test the forward damping coefficient being $X_u$ from the damping matrix $D$. The vessel will accelerate to a certain velocity and keep this. Then all input is put to zero and the vessel will decelerate. This will, as described in section \ref{sec:hydrocoeff}, give a damping coefficient in the forward motion. This is expressed as $m \ddot x - X_u \dot x = 0$ and $X_u$ can be estimated. A step input is now set on the vessel to see the acceleration from zero velocity to the same constant velocity as before. This now gives the input force at the vessel, which is the last unknown in $m \ddot x - X_u \dot x = \tau$.
	\item The second test is a purely \textit{sway} test. The vessel will make use of the sideways thrusters to move strictly sideways. This implies that there is no rotation or movement in $\psi$ and $x$. Thus makes the moving equation as $m \ddot y - Y_v \dot y = 0$. Here is the vessel again accelerated to a constant velocity and the input is then set to zero, and $Y_v$ can be determined. After this the sideways thrusters can be used to accelerate the vessel and the input can be estimated by $m \ddot y - Y_v \dot y = \tau$ where $\tau$ is the only unknown.
	\item The last test is the \textit{yaw} test. In this test it is of importance to control the sideways thrusters such that the vessel will keep the position at both $x$ and $y$, suck that only rotation is used to move the surrounding water. The vessel is accelerated to a constant angular velocity and the input is then set to zero. The damping of this will determine $N_r$ from $I_z\ddot \psi - N_r \dot \psi = 0$. Now the vessel needs to reach the constant angular velocity again from zero, and the input can now be estimated from $I_z\ddot \psi - N_r \dot \psi = \tau$.
\end{enumerate}

\section{Results}
\subsubsection{Surge test}
\missingfigure{Maalinger af acceleration fra 0 til konstant hastighed
+ Maaling af deceleration med 0 input fra konstant hastighed +
regræssionskurve af disse}
\subsubsection{Sway test}
\missingfigure{Maalinger af acceleration fra 0 til konstant hastighed
+ Maaling af deceleration med 0 input fra konstant hastighed +
regræssionskurve af disse}
\subsubsection{Yaw test}
\missingfigure{Maalinger af acceleration fra 0 til konstant vinkel
hastighed + Maaling af deceleration med 0 input fra konstant vinkel
hastighed + regræssionskurve af disse}

The results from measurements and estimation can be found in table \ref{tab:dmatrix}.


\begin{table}[htbp]
\centering
\begin{tabular}{ccc}
	\toprule
  Coefficient & Value \\
  \midrule
  $m$ & 2 \\
  $x_g$ & 2 \\
	\dots\\
	\bottomrule
\end{tabular}
\caption{Rigig body mass matrix constants for $M_{RB}$}
\label{tab:constants}
\end{table}

\begin{table}[htbp]
\centering
\begin{tabular}{ccc}
	\toprule
  Hydrodynamic\\Coefficient & Value \\
  \midrule
  $X_u$ & 2 \\
  $Y_v$ & 2 \\
  $N_r$ & 2 \\
  $Y_r$ & 2 \\
  $N_v$ & 2 \\
	\bottomrule
\end{tabular}
\caption{Results of fitted values and the calculated coefficients.}
\label{tab:dmatrix}
\end{table}


\section{Discussion}


\section{Conclusion}

